{% extends "base.html" %}
{% load static %}

{% block header %}
<link rel="stylesheet" type="text/css" href="{% static 'DataTables/datatables.css' %}">
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function () {

        var table = $('#myTable').DataTable({
            "ordering": true,
            "ajax": "/ajax/get_company_list/",
            rowId: function (a) {
                return 'pk_' + a.id;
            },
            "columns": [
                // { "data": "id" },
                { "data": "name" },
                { "data": "cnpj" },
                { "data": "" },
                // { "data": "addresses" },
            ],
            "columnDefs": [{
                "targets": -1,
                "data": null,
                "defaultContent": "<button class='delete-row btn btn-danger'>Delete!</button>",
            }],
        });

        $('#myTable tbody').on('click', 'button.delete-row', function () {


            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.value) {
                    console.log('Imprimir linha abaixo: ');
                    pk = $(this).closest('tr').attr('id').substr(3);
                    deleteCompany(parseInt(pk, 10));
                    Swal.fire(
                        'Deleted!',
                        'Your file has been deleted.',
                        'success'
                    )
                }
            })

            var data = table.row($(this).parents('tr')).data();

        });

    });
</script>
{% endblock header %}

{% block content %}

<!-- Page-header start -->
<div class="col-sm-12">

    <div class="card">
        <div class="card-header">
            <h4 class="m-b-10">Companies</h4>
        </div>
        <div class="card-block">
            <p class="text-muted m-b-10">Here you can find iformation about the companies recorded in our catalog.</p>
        </div>
    </div>

</div>
<!-- Page-header end -->

<!-- Page-content start -->

<div class="col-sm-12">
    <div class="card">
        <div class="card-header">
            <h5>List of Companies</h5>
            <button class="btn btn-success" id="reload"><i class="icofont icofont-star"></i>Reload</button>
        </div>
        <div class="card-block">

            <table id="myTable" class="display" style="width:100%">
                <thead>
                    <tr>
                        <!-- <th style="visibility: hidden;">Id</th> -->
                        <th>Name</th>
                        <th>CNPJ</th>
                        <th>Tools</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <!-- <th style="visibility: hidden;">Id</th> -->
                        <th>Name</th>
                        <th>CNPJ</th>
                        <th>Tools</th>
                    </tr>
                </tfoot>
            </table>

        </div>
    </div>
</div>
<!-- Page-content end -->

{% endblock content %}

{% block scripts %}
<script src="{% static 'js/app.js' %}"></script>

<script type="text/javascript" charset="utf8" src="{% static 'DataTables/datatables.js' %}"></script>
<script src="http://malsup.github.io/jquery.blockUI.js"></script>
{% endblock scripts %}